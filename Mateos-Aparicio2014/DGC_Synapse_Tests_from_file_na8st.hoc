
load_file("nrngui.hoc")

// Load the granule cell template
xopen("DGC_Template_from_file_na8st.hoc")

xopen ("rn.hoc")

proc synapse_group_test () { localobj gc, synlist, v, vv 
    
    strdef label, msg, results_path
    
    gc = $o1
    synlist = $o2
    label = $s3
    results_path = $s4
    
    vv = new Vector()
    vv.append(0,0,0,0,0,0)
    
    for i=0, synlist.count()-1 {
        v = gc.syntest(synlist.o(i))
        vv = vv.add(v)
    }
    vv.div(gc.syns_GC.count())
    
    amp = vv.x(0)
    t_10_90 = vv.x(1)
    t_20_80 = vv.x(2)
    t_all = vv.x(3)
    t_50 = vv.x(4)
    t_decay = vv.x(5)
    
    logfile = new File()
    sprint (log_fn, "%s/DGC_synapse_%06d.dat", results_path, gid )
    logfile.wopen ( log_fn )

    sprint(msg, "%s synapses:\n", label)
    logfile.printf(msg)
    logfile.printf("  Amplitude\t\t %f\n",amp)
    logfile.printf("  10-90 Rise Time\t\t %f\n",t_10_90)
    logfile.printf("  20-80 Rise Time\t\t %f\n",t_20_80)	
    logfile.printf("  Time to Peak\t\t %f\n",t_all)	
    logfile.printf("  Time to 50\t\t %f\n",t_50)
    logfile.printf("  Decay Time Constant\t %f\n",t_decay)	
    
    logfile.close()

}


proc synapse_test() { local gid localobj gc strdef forest_path, results_path
    
    forest_path = $s1
    results_path = $s2
    gid = $3
    
    print "DGC synapse test: gid = ", gid
    
    gc = new DGC(gid, 1, forest_path, 0)
    
    synapse_group_test(gc, gc.syns_GC, "GC-GC", results_path)
    synapse_group_test(gc, gc.syns_MC, "MC-GC", results_path)
    synapse_group_test(gc, gc.syns_HC, "HC-GC", results_path)
    synapse_group_test(gc, gc.syns_BC, "BC-GC", results_path)
    synapse_group_test(gc, gc.syns_AA, "AA-GC", results_path)
    synapse_group_test(gc, gc.syns_HCC, "HCC-GC", results_path)
    synapse_group_test(gc, gc.syns_NGFC_GABAA, "NGFC-GC GABAA", results_path)
    synapse_group_test(gc, gc.syns_NGFC_GABAB, "NGFC-GC GABAB", results_path)
}


/*
strdef local_forest_path, local_results_path

gid = 307
local_forest_path = "/home/igr/src/model/DGC_forest/dat/110/007"
local_results_path = "results"

gid = 827
local_forest_path = "/home/igr/src/model/DGC_forest/dat/110/007"
local_results_path = "results"

gid = 016
local_forest_path = "/home/igr/src/model/DGC_forest/dat/110/016"
local_results_path = "results"

gid = 134
local_forest_path = "/home/igr/src/model/DGC_forest/dat/110/014"
local_results_path = "results"

gid = 005
local_forest_path = "/home/igr/src/model/DGC_forest/dat/110/005"
local_results_path = "results"

gid = 003
local_forest_path = "/home/igr/src/model/DGC_forest/dat/110/003"
local_results_path = "results"

gid = 9016
local_forest_path = "/pub/iraikov/dentate/slice0000/GC/0/0/1/"
local_results_path = "results"

gid = 001
local_forest_path = "/home/igr/src/model/DGC_forest/dat/110/001"
local_results_path = "results"

synapse_test(local_forest_path, local_results_path, gid)
*/